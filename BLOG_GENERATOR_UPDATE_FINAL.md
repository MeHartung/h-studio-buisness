# Обновление генератора блога - Финальная версия

## Что было сделано

### 1. Обновлены правила генерации (`scripts/ai_rules.json`)

Добавлены строгие ограничения:
- ✅ Разрешённые тематики (6 категорий)
- ❌ Запрещённые темы (Next.js, React, DevOps, CI/CD, e-commerce и т.д.)
- ✅ Разрешённые категории (9 категорий)
- ✅ Разрешённые теги (14 тегов)
- ❌ Запрещённые слова (GitHub Actions, deploy, pipeline и т.д.)

### 2. Обновлены промпты генерации (`scripts/generate-with-ai.js`)

- ✅ Добавлена жёсткая структура из 11 обязательных разделов
- ✅ Добавлены строгие правила о разрешённых/запрещённых темах
- ✅ Обновлены требования к стилю (деловой русский, производственные примеры)
- ✅ Добавлена валидация тем и категорий перед генерацией
- ✅ Обновлена функция генерации тегов (только разрешённые теги)

### 3. Обновлён поиск тем (`scripts/topic-search.js`)

- ✅ Добавлены правила о разрешённых/запрещённых темах в промпт
- ✅ Улучшена фильтрация тем для производственных компаний

### 4. Добавлена автоматическая генерация

#### Новый скрипт: `scripts/auto-generate-from-topics.js`
- Автоматически генерирует статьи из `topics-search-results.json`
- Определяет категорию на основе тегов
- Обрабатывает ошибки и показывает статистику

#### Новый workflow: `.github/workflows/auto-generate-blog.yml`
- **Автоматический запуск**: каждый понедельник в 9:00 UTC (12:00 МСК)
- **Ручной запуск**: через GitHub Actions UI
- **Процесс**:
  1. Ищет 5 новых тем
  2. Генерирует статьи из найденных тем
  3. Автоматически коммитит и пушит изменения

## Структура статьи (11 обязательных разделов)

1. **Введение**: боль директора/главного инженера
2. **Симптомы проблемы** (5–7 маркеров с цифрами)
3. **Финансовые риски / реальные потери** (обязательно цифры)
4. **Как работает правильная автоматизация**
5. **Quick wins на 1–2 недели**
6. **Кейс** (только производство)
7. **Пример типичной ошибки**
8. **Критерии выбора решения**
9. **Что делать завтра** — практические шаги
10. **Короткое резюме**
11. **Связанные услуги** (строго релевантные)

## Разрешённые тематики

1. **Автоматизация расчётов**: себестоимость, параметры изделий, масса/материалы/сроки, контроль ошибок, маржинальность
2. **Автоматизация КП**: автоматизация КП, генерация спецификаций, PDF, маржинальность в КП
3. **Документооборот и согласования**: цифровизация, маршруты, версии, устранение ошибок
4. **Интеграции**: 1С, ERP, CRM, обмен данными
5. **AI в производстве**: AI-оценка себестоимости, AI-аналитика, выявление узких мест
6. **Управление эффективностью**: повышение маржинальности, ускорение КП, устранение ошибок, оптимизация проектов

## Запрещённые темы

- Next.js, React, Netlify, веб-разработка
- Маркетинг, performance, A/B-тесты
- DevOps, CI/CD, GitHub Actions
- Kubernetes
- Безопасность веб-приложений
- Сайты, дизайн, контент-менеджмент
- Bali, Berin, стартапы
- e-commerce, рестораны, магазины, сервисы, SaaS

## Использование

### Ручная генерация

```bash
# Генерация одной статьи
npm run blog:generate:ai -- --topic "автоматизация расчётов себестоимости" --category "Автоматизация"

# Поиск тем
npm run blog:search-topics -- --query "автоматизация КП" --count 10

# Автоматическая генерация из найденных тем
npm run blog:auto-generate -- --count 1
```

### Автоматическая генерация через GitHub Actions

1. **Автоматически**: каждый понедельник в 12:00 МСК
2. **Вручную**: GitHub → Actions → "Auto Generate Blog Posts" → Run workflow

## Валидация

Перед генерацией статьи проверяется:
- ✅ Тема не содержит запрещённых слов
- ✅ Категория в списке разрешённых
- ✅ Нет дубликатов (в течение 30 дней)
- ✅ Теги соответствуют разрешённому списку

## Настройка автоматической генерации

Для работы автоматической генерации необходимо:

1. **Добавить секрет в GitHub**:
   - Settings → Secrets and variables → Actions
   - Добавить `OPENAI_API_KEY` с вашим API ключом OpenAI

2. **Проверить расписание**:
   - Файл: `.github/workflows/auto-generate-blog.yml`
   - Текущее расписание: каждый понедельник в 9:00 UTC (12:00 МСК)
   - Можно изменить в строке: `cron: '0 9 * * 1'`

3. **Проверить права доступа**:
   - Workflow должен иметь права на запись в репозиторий
   - Settings → Actions → General → Workflow permissions → "Read and write permissions"

## Чеклист валидации

Перед выводом статьи проверяется:
- ✔ Тема соответствует производству
- ✔ Есть все 11 структурных пунктов
- ✔ Нет технического кода
- ✔ Нет фронтэнда, DevOps, CI/CD
- ✔ Присутствуют цифры потерь и результаты
- ✔ Кейс именно производственный
- ✔ Категория и теги соответствуют спискам
- ✔ Текст 100% про бизнес-процессы, расчёты, документы
- ✔ Нет слов: GitHub, Next.js, Kubernetes, deploy, pipeline

## Файлы

- `scripts/ai_rules.json` - правила и ограничения
- `scripts/generate-with-ai.js` - основной генератор статей
- `scripts/topic-search.js` - поиск тем
- `scripts/auto-generate-from-topics.js` - автоматическая генерация из тем
- `.github/workflows/auto-generate-blog.yml` - автоматический workflow

